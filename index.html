<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declaración de Obras Audiovisuales</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header-with-logo">
            <img src="assets/Logo-Fondo-Transparente@3x(1).png" alt="Logo" class="logo">
            <h1>Declaración de Obras Audiovisuales</h1>
        </div>
        <form id="obraForm">
            <!-- Sección 1: Datos Generales -->
            <section class="form-section">
                <h2>Datos Generales</h2>
                <div class="form-group">
                    <label for="tituloOriginal">Título original <span class="required">*</span></label>
                    <input type="text" id="tituloOriginal" required>
                </div>

                <div class="form-group">
                    <label for="tipoFormato">Tipo de formato <span class="required">*</span></label>
                    <select id="tipoFormato" required>
                        <option value="">Seleccione...</option>
                        <option value="Largometraje">Largometraje</option>
                        <option value="Cortometraje">Cortometraje</option>
                        <option value="Serie">Serie</option>
                        <option value="Telenovela">Telenovela</option>
                        <option value="Serie documental">Serie documental</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="genero">Género <span class="required">*</span></label>
                    <select id="genero" required disabled>
                        <option value="">Seleccione un formato primero</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="empresaProductora">Empresa productora <span class="required">*</span></label>
                    <select id="empresaProductora" class="select2" multiple="multiple" required>
                        <!-- Las opciones se cargarán dinámicamente -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="paisProduccion">País de producción</label>
                    <select id="paisProduccion" class="select2" multiple="multiple">
                        <!-- Las opciones se cargarán dinámicamente -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="anioProduccion">Año de producción <span class="required">*</span></label>
                    <input type="number" id="anioProduccion" min="1900" max="2100" required>
                </div>

                <div class="form-group">
                    <label for="idioma">Idioma</label>
                    <select id="idioma">
                        <option value="">Seleccione...</option>
                        <option value="Español">Español</option>
                        <option value="Inglés">Inglés</option>
                        <option value="Francés">Francés</option>
                        <option value="Alemán">Alemán</option>
                        <option value="Italiano">Italiano</option>
                        <option value="Portugués">Portugués</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>


                <div class="form-group">
                    <label for="actores">Actores</label>
                    <input type="text" id="actores" placeholder="Separar nombres con comas">
                </div>


                <div class="form-group">
                    <label for="directores">Directores</label>
                    <input type="text" id="directores" placeholder="Separar nombres con comas">
                </div>


                <div class="form-group">
                    <label for="guionistas">Guionistas</label>
                    <input type="text" id="guionistas" placeholder="Separar nombres con comas">
                </div>

            </section>

            <!-- Sección 2: Exhibición Internacional -->
            <section id="exhibicionSection" class="form-section">
                <div class="section-header">
                    <div>
                        <h2>Exhibición internacional de la obra <span class="optional-badge">(Opcional)</span></h2>
                        <p class="help-text">Complete esta sección solo si la obra ha tenido exhibición internacional. No es obligatorio completar este apartado.</p>
                    </div>
                    <button type="button" class="btn btn-secondary" id="addExhibicion">+ Agregar Exhibición</button>
                </div>
                <div id="exhibicionesContainer">
                    <!-- Exhibiciones se agregarán aquí dinámicamente -->
                </div>
            </section>

            <!-- Sección de Líneas de Participación (para obras no serializadas) -->
            <section id="lineasNoSerializadasSection" class="form-section" style="display: none;">
                <div class="section-header">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <h2>Líneas de Participación</h2>
                        <div class="help-tooltip" style="margin-top: 0.25rem;">
                            <span class="help-icon">?</span>
                            <div class="tooltip-content">
                                <h4>Instrucciones para declarar líneas de participación:</h4>
                                <p>En cada línea de participación, registra el rol, autor y porcentaje correspondiente a cada participante en la obra.</p>
                                <p>Recuerda que la suma de los porcentajes para un mismo rol no puede superar el 100%.</p>
                                <p>Si necesitas agregar participantes con diferentes roles, crea una nueva línea para cada uno.</p>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary btn-add" id="addLineaNoSerializada"><i class="fas fa-plus"></i> Agregar Línea</button>
                </div>
                <div id="lineasNoSerializadasContainer">
                    <!-- Líneas de participación se agregarán aquí dinámicamente -->
                </div>
            </section>

            <!-- Sección de Bloques de Episodios (inicialmente oculta) -->
            <section class="form-section" id="episodiosSection" style="display: none;">
                <div class="section-header">
                    <h2>Bloques de Episodios</h2>
                    <button type="button" class="btn btn-secondary btn-add" id="addBloqueEpisodios"><i class="fas fa-plus"></i> Agregar Bloque</button>
                </div>
                <div id="bloquesEpisodiosContainer">
                    <!-- Bloques de episodios se agregarán aquí dinámicamente -->
                </div>
            </section>


            <div class="form-actions">
                <button type="submit" id="submitButton" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Enviar Declaración</button>
                <button type="reset" class="btn btn-secondary"><i class="fas fa-eraser"></i> Limpiar Formulario</button>
            </div>
        </form>
    </div>

    <!-- Templates -->
    <template id="exhibicionTemplate">
        <div class="exhibicion-item">
            <div class="form-row">
                <div class="form-group">
                    <label>Otro título</label>
                    <input type="text" class="otroTitulo">
                </div>
                <div class="form-group">
                    <label>Idioma</label>
                    <select class="idiomaExhibicion">
                        <option value="">Seleccione...</option>
                        <option value="Español">Español</option>
                        <option value="Inglés">Inglés</option>
                        <option value="Francés">Francés</option>
                        <option value="Alemán">Alemán</option>
                        <option value="Italiano">Italiano</option>
                        <option value="Portugués">Portugués</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>País de exhibición</label>
                    <select class="paisExhibicion select2">
                        <option value="">Buscar o agregar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Canal / Plataforma / Sala</label>
                    <select class="canalExhibicion select2">
                        <option value="">Buscar o agregar...</option>
                    </select>
                </div>
            </div>
            <button type="button" class="btn-remove">
                <i class="fas fa-times"></i> Eliminar
            </button>
        </div>
    </template>

    <template id="bloqueEpisodiosTemplate">
        <div class="bloque-episodios">
            <div class="bloque-header">
                <div class="bloque-title">
                    <h3>Bloque de Episodios</h3>
                    <div class="help-tooltip">
                        <span class="help-icon">?</span>
                        <div class="tooltip-content">
                            <h4>Instrucciones para declarar episodios:</h4>
                            <p>En cada bloque de episodios, registra el intervalo de episodios que comparten los mismos autores, roles y porcentajes de participación.</p>
                            <p>Esto te permitirá agrupar episodios con características similares y simplificar la declaración.</p>
                            <p>Si existen episodios con distinta participación de autores o porcentajes, crea un nuevo bloque para reflejar esa diferencia.</p>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-remove">Eliminar Bloque</button>
            </div>
            
            <!-- Subbloque 1: Intervalo de episodios -->
            <div class="subbloque">
                <div class="form-row">
                    <div class="form-group">
                        <label>Temporada</label>
                        <input type="number" class="temporada" min="1" placeholder="N°">
                    </div>
                    <div class="form-group">
                        <label>Desde episodio</label>
                        <input type="number" class="desdeEpisodio" min="1">
                    </div>
                    <div class="form-group">
                        <label>Hasta episodio</label>
                        <input type="number" class="hastaEpisodio" min="1">
                    </div>
                    <div class="form-group" style="align-self: flex-end;">
                        <button type="button" class="btn btn-secondary btn-small btn-generar-tabla">Generar Tabla</button>
                    </div>
                </div>
                
                <div class="tabla-episodios-container" style="margin-top: 1rem; display: none;">
                    <div class="table-responsive">
                        <table class="tabla-episodios">
                            <thead>
                                <tr>
                                    <th>Episodio</th>
                                    <th>Título</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Las filas de la tabla se generarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Subbloque 2: Líneas de participación -->
            <div class="subbloque">
                <div class="subbloque-header">
                    <div class="bloque-title">
                        <h4>Líneas de participación</h4>
                        <div class="help-tooltip">
                            <span class="help-icon">?</span>
                            <div class="tooltip-content">
                                <h4>Instrucciones para declarar líneas de participación:</h4>
                                <p>En cada línea de participación, registra el rol, autor y porcentaje correspondiente a cada participante en la obra.</p>
                                <p>Recuerda que la suma de los porcentajes para un mismo rol no puede superar el 100%.</p>
                                <p>Si necesitas agregar participantes con diferentes roles, crea una nueva línea para cada uno.</p>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-small btn-add-linea">+ Agregar Línea</button>
                </div>
                <div class="lineas-participacion">
                    <!-- Líneas de participación se agregarán aquí dinámicamente -->
                </div>
            </div>
        </div>
    </template>

    <template id="lineaParticipacionTemplate">
        <div class="linea-participacion">
            <div class="form-row">
                <div class="form-group">
                    <label>Rol</label>
                    <select class="rol select2" style="width: 100%;">
                        <!-- Las opciones se cargarán dinámicamente desde el JSON -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Autor</label>
                    <select class="autor select2">
                        <option value="">Buscar o agregar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>% Participación <span class="required">*</span></label>
                    <input type="number" class="porcentaje" min="0" max="100" step="0.01" required>
                </div>
                <div class="form-group">
                    <button type="button" class="btn-remove" onclick="removeLineaParticipacion(this)">
                        <i class="fas fa-times"></i> Eliminar
                    </button>
                </div>
            </div>
        </div>
    </template>

    <template id="tituloAlternativoTemplate">
        <div class="titulo-alternativo">
            <div class="form-row">
                <div class="form-group">
                    <label>Otro título</label>
                    <input type="text" class="otro-titulo form-control" placeholder="Título alternativo">
                </div>
                <div class="form-group">
                    <label>Idioma</label>
                    <select class="idioma-alternativo select2" style="width: 100%;">
                        <!-- Se cargarán dinámicamente -->
                    </select>
                </div>
                <div class="form-group">
                    <label>País</label>
                    <select class="pais-alternativo select2" style="width: 100%;">
                        <!-- Se cargarán dinámicamente -->
                    </select>
                </div>
                <div class="form-group" style="align-self: flex-end;">
                    <button type="button" class="btn-remove" onclick="removeTituloAlternativo(this)">
                        <i class="fas fa-times"></i> Eliminar
                    </button>
                </div>
            </div>
        </div>
    </template>


    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
